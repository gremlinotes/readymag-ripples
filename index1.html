<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Readymag Ripples — Debug Build</title>
<style>
  html,body { height:100%; margin:0; background:#07080a; font-family:system-ui, -apple-system, "Segoe UI", Roboto; }
  #debug {
    position:fixed; left:12px; top:12px; z-index:9999;
    background:rgba(0,0,0,0.55); color:#fff; padding:8px 10px; border-radius:8px;
    font-size:13px; line-height:1.2; pointer-events:none;
    max-width:80vw; box-shadow:0 6px 22px rgba(0,0,0,0.5);
  }
  canvas { display:block; width:100%; height:100%; position:fixed; left:0; top:0; }
  .hint { opacity:0.85; font-size:12px; margin-top:6px; color:#cfe9ff; pointer-events:none; }
</style>
</head>
<body>
  <div id="debug">Initializing…</div>
  <canvas id="ripplesCanvas"></canvas>

<script>
(function(){
  const debug = document.getElementById('debug');
  function status(msg, isError){
    debug.textContent = msg;
    debug.style.background = isError ? 'rgba(180,20,20,0.85)' : 'rgba(0,0,0,0.55)';
    if (isError) console.error('[ripples] ' + msg); else console.log('[ripples] ' + msg);
  }

  status('script loaded — checking environment');

  try {
    const canvas = document.getElementById('ripplesCanvas');
    if(!canvas){ status('Canvas element missing', true); throw new Error('missing canvas'); }

    const ctx = canvas.getContext && canvas.getContext('2d');
    if(!ctx){ status('2D canvas not supported in this browser', true); throw new Error('no 2d context'); }

    status('Canvas OK — sizing…');

    function resize(){
      const rect = canvas.getBoundingClientRect();
      // Use client size to avoid CSS collapses in some hosts
      const w = Math.max(1, Math.round(rect.width || window.innerWidth));
      const h = Math.max(1, Math.round(rect.height || window.innerHeight));
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.width = Math.round(w * dpr);
      canvas.height = Math.round(h * dpr);
      canvas.style.width = (w) + 'px';
      canvas.style.height = (h) + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    // ensure the canvas fills viewport even if GitHub page wrapper changes
    canvas.style.width = '100%';
    canvas.style.height = '100%';
    window.addEventListener('resize', resize);
    // call twice to be safe
    resize();
    resize();

    status('Starting renderer — click/tap canvas to create ripples');

    // Simple expanding circle ripple implementation (robust)
    const ripples = [];
    const fade = 0.96;

    function addRipple(x,y){
      ripples.push({ x: x, y: y, r: 6, a: 1, growth: 3 + Math.random()*2 });
      // haptic if available
      if(navigator.vibrate) try { navigator.vibrate(20); } catch(_) {}
    }

    // pointer events: map coordinates to canvas client box
    canvas.addEventListener('pointerdown', function(ev){
      const rect = canvas.getBoundingClientRect();
      addRipple(ev.clientX - rect.left, ev.clientY - rect.top);
    }, { passive:true });

    function draw(){
      const rect = canvas.getBoundingClientRect();
      const w = rect.width, h = rect.height;
      // background gradient
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0,'#03101a');
      g.addColorStop(1,'#000814');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // draw ripples
      for(let i = ripples.length - 1; i >= 0; i--){
        const rp = ripples[i];
        ctx.beginPath();
        ctx.arc(rp.x, rp.y, rp.r, 0, Math.PI*2);
        ctx.strokeStyle = `rgba(64,200,255,${Math.max(0, rp.a)})`;
        ctx.lineWidth = 2;
        ctx.stroke();
        rp.r += rp.growth;
        rp.a *= fade;
        if(rp.a < 0.02) ripples.splice(i, 1);
      }
      requestAnimationFrame(draw);
    }

    requestAnimationFrame(draw);
    status('Renderer running — click to test (console logs available)');

    // expose small diagnostics to console
    window.__ripplesDiag = {
      addRipple,
      ripples
    };
  } catch(err){
    status('Initialization failed — open DevTools Console for details', true);
    console.error(err);
  }
})();
</script>

</body>
</html>

